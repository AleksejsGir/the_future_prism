
{% extends "base.html" %}
{% load i18n %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">

  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
  {% if search_query %}
    <div class="text-center mb-6">
      <p class="text-gray-300">
        {% if news_list %}
          {% blocktrans with query=search_query %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "{{ query }}"{% endblocktrans %}
        {% else %}
          {% blocktrans with query=search_query %}–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ{% endblocktrans %}
        {% endif %}
      </p>
    </div>
  {% endif %}

  <!-- –°–µ–∫—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
  <div class="category-section mb-8">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" -->
    <div class="category-title-wrapper text-center mb-4">
      <h2 class="category-title">{% trans "–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" %}</h2>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div class="category-filter flex flex-wrap justify-center gap-3 md:gap-4">
      <a href="{% url 'news_list' %}{% if search_query %}?search={{ search_query }}{% endif %}"
         class="category-button {% if not request.GET.category %}active-category{% endif %}">
        üåê {% trans "–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" %}
      </a>
      {% for category in categories %}
        <a href="?{% if search_query %}search={{ search_query }}&{% endif %}category={{ category.id }}"
           class="category-button {% if request.GET.category == category.id|stringformat:'s' %}active-category{% endif %}">
          {{ category.icon|default:'üè∑Ô∏è' }} {{ category.name }}
        </a>
      {% empty %}
        <p class="text-center text-gray-400">{% trans "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã" %}</p>
      {% endfor %}
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞) -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
    {% for news in news_list %}
      <!-- –í–º–µ—Å—Ç–æ <div class="news-card ..."> –∏—Å–ø–æ–ª—å–∑—É—é <a> –æ–±—ë—Ä—Ç–∫—É -->
      <a href="{% url 'news_detail' news.id %}"
         class="news-card transition-all duration-300 block"
         style="--card-index: {{ forloop.counter0 }};">
        {% if news.image %}
          <img src="{{ news.image.url }}"
               alt="{{ news.title }}"
               class="w-full h-48 object-cover rounded-lg mb-3">
        {% endif %}

        <h2 class="text-xl font-semibold">
          {{ news.title }}
        </h2>

        <div class="mt-2 text-gray-300 news-preview">
          {{ news.content|striptags|truncatewords:20 }}
        </div>

        <!-- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤–Ω–∏–∑—É –∫–∞—Ä—Ç–æ—á–∫–∏, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å: -->
        {% if news.category %}
          <span class="text-sm text-gray-400 block mt-4">
            {{ news.category.icon|default:'üè∑Ô∏è' }} {{ news.category.name }}
          </span>
        {% endif %}
      </a>
    {% empty %}
      <div class="col-span-full text-center">
        {% if search_query %}
          <p class="text-gray-400">{% trans "–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" %}</p>
          <a href="{% url 'news_list' %}" class="mt-4 inline-block neon-button px-4 py-2">
            {% trans "–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∏—Å–∫" %}
          </a>
        {% else %}
          <p class="text-gray-400">{% trans "–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç" %}</p>
        {% endif %}
      </div>
    {% endfor %}
  </div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (—É–ª—É—á—à–µ–Ω–Ω–∞—è) -->
{% if is_paginated %}
  <div class="pagination-container mt-8 flex justify-center gap-2">
    {% if page_obj.has_previous %}
      <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}page={{ page_obj.previous_page_number }}"
         class="neon-button px-4 py-2">
        {% trans "–ü—Ä–µ–¥—ã–¥—É—â–∞—è" %}
      </a>
    {% endif %}

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <span class="current-page px-4 py-2">
      –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
      <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}page={{ page_obj.next_page_number }}"
         class="neon-button px-4 py-2">
        {% trans "–°–ª–µ–¥—É—é—â–∞—è" %}
      </a>
    {% endif %}
  </div>

  <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–≤—Ä–µ–º–µ–Ω–Ω–æ) -->
  <div class="text-center mt-4 text-gray-500" style="font-size: 0.8rem;">
    <p>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: {{ page_obj.paginator.count }} | –°—Ç—Ä–∞–Ω–∏—Ü: {{ page_obj.paginator.num_pages }}</p>
  </div>
{% elif news_list.has_other_pages %}
  <!-- –†–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏, –µ—Å–ª–∏ is_paginated –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç -->
  <div class="pagination-container mt-8 flex justify-center gap-2">
    {% if news_list.has_previous %}
      <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}page={{ news_list.previous_page_number }}"
         class="neon-button px-4 py-2">
        {% trans "–ü—Ä–µ–¥—ã–¥—É—â–∞—è" %}
      </a>
    {% endif %}

    <span class="current-page px-4 py-2">
      –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ news_list.number }} –∏–∑ {{ news_list.paginator.num_pages }}
    </span>

    {% if news_list.has_next %}
      <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}page={{ news_list.next_page_number }}"
         class="neon-button px-4 py-2">
        {% trans "–°–ª–µ–¥—É—é—â–∞—è" %}
      </a>
    {% endif %}
  </div>
{% endif %}
<script>


  // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  document.addEventListener('DOMContentLoaded', function() {
    const categoryFilter = document.querySelector('.category-filter');
    if (categoryFilter) {
      setTimeout(() => {
        categoryFilter.style.opacity = '1';
        categoryFilter.style.transform = 'translateY(0)';
      }, 300);
    }

    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ HTML-—Å–∏–º–≤–æ–ª–æ–≤
    const previews = document.querySelectorAll('.news-preview');
    previews.forEach(preview => {
      preview.innerHTML = preview.innerHTML
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&amp;/g, '&')
        .replace(/&quot;/g, '"')
        .replace(/&#39;/g, "'")
        .replace(/&nbsp;/g, ' ');
    });
  });
</script>
{% endblock %}